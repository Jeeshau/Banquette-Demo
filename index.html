<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HDRI Test — R=150" / Z≈35"</title>
  <style>
    html, body { height: 100%; margin: 0; background: #000; overflow: hidden; }
    model-viewer { width: 100%; height: 100%; background: transparent; --poster-color: transparent; }
    .ui {
      position: absolute; left: 12px; top: 12px; display: flex; gap: 10px; align-items: center;
      padding: 8px 10px; border-radius: 10px; background: rgba(0,0,0,.35); backdrop-filter: blur(6px);
      color:#fff; font: 14px/1 ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial;
    }
    select, label { font-size: 14px; color:#fff; }
  </style>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <model-viewer id="mv"
    src="./model001.glb"
    camera-controls
    interaction-prompt="none"
    disable-zoom
    field-of-view="20deg"
    camera-orbit="0deg 13.49deg 150in"
    min-camera-orbit="auto 13.49deg 150in"
    max-camera-orbit="auto 13.49deg 150in"
    reveal-when-loaded
    style="background: transparent;">
  </model-viewer>

  <div class="ui">
    <label>Model:
      <select id="sel">
        <option value="./model001.glb">model001.glb</option>
        <option value="./model002.glb">model002.glb</option>
        <option value="./model003.glb">model003.glb</option>
      </select>
    </label>
    <label title="勾选后再加载 HDRI（需与 index.html 同目录）">
      <input type="checkbox" id="hdr"> HDRI
    </label>
  </div>

  <script>
    const mv   = document.getElementById('mv');
    const sel  = document.getElementById('sel');
    const hdr  = document.getElementById('hdr');

    // 固定高度≈35"与距离150"（φ = asin(35/150) ≈ 13.49°）
    const TARGET_Z_IN = 35;
    const phiDeg = (rIn) => Math.asin(Math.max(Math.min(TARGET_Z_IN / rIn, 1), 0)) * 180 / Math.PI;

    function lockCamera(rIn) {
      const theta = mv.getCameraOrbit().theta * 180 / Math.PI; // 保持当前水平角
      const phi   = phiDeg(rIn);
      const orbit = `${theta.toFixed(2)}deg ${phi.toFixed(2)}deg ${rIn}in`;
      mv.setAttribute('camera-orbit', orbit);
      mv.setAttribute('min-camera-orbit', `auto ${phi.toFixed(2)}deg ${rIn}in`);
      mv.setAttribute('max-camera-orbit', `auto ${phi.toFixed(2)}deg ${rIn}in`);
    }

    // 切换模型
    sel.addEventListener('change', () => {
      mv.setAttribute('src', sel.value); // ./model001.glb 等相对路径
    });

    // 勾选后加载/移除 HDRI（与 index.html 同目录）
    hdr.addEventListener('change', () => {
      if (hdr.checked) {
        mv.setAttribute('environment-image', './Background_sculpture_exhibition_4k.hdr');
        mv.setAttribute('skybox-image', './Background_sculpture_exhibition_4k.hdr');
        mv.setAttribute('exposure', '1.0');
      } else {
        mv.removeAttribute('environment-image');
        mv.removeAttribute('skybox-image');
      }
    });

    // 初次加载后锁定一次
    mv.addEventListener('load', () => lockCamera(150));
  </script>
</body>
</html>
