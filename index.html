<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Model — Infinite Ground</title>
  <style>
    /* 全屏无边框展示 */
    html, body {
      height: 100%;
      margin: 0;
      background: #000; /* 透明也可：改成 transparent */
      overflow: hidden;
    }
    .stage {
      position: relative;
      width: 100%;
      height: 100%;
    }

    /* model-viewer 填满舞台 */
    model-viewer {
      width: 100%;
      height: 100%;
      --poster-color: transparent;
      background: transparent;
    }

    /* “无限地板”——不参与 3D 场景，只是一个页面上的视觉层 */
    .infinite-ground {
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%) translateY(var(--lift, 0px)) scale(var(--scale, 1));
      width: 120vmin;   /* 基础直径，会被 JS 动态缩放 */
      height: 120vmin;
      pointer-events: none;
      /* 椭圆渐变地面 + 轻微模糊，模拟落地衰减 */
      background:
        radial-gradient(ellipse at center,
          rgba(0,0,0,0.35) 0%,
          rgba(0,0,0,0.25) 20%,
          rgba(0,0,0,0.08) 55%,
          rgba(0,0,0,0.02) 78%,
          rgba(0,0,0,0.0) 100%);
      filter: blur(2px);
      /* “压扁”成接地椭圆（视觉更贴地） */
      transform-origin: center center;
      border-radius: 50%;
      /* 通过 CSS 变量控制“椭圆度” */
      clip-path: ellipse(60% 25% at 50% 63%);
      mix-blend-mode: multiply; /* HDRI 较亮时更自然 */
    }

    /* 可选：在极浅色背景下，切到叠加模式 */
    @media (prefers-color-scheme: light) {
      .infinite-ground { mix-blend-mode: multiply; }
    }
  </style>
  <!-- 引入 model-viewer（官方 CDN） -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <div class="stage">
    <model-viewer id="mv"
      src="model.glb"
      camera-controls
      touch-action="pan-y"
      autoplay
      exposure="1.0"
      shadow-intensity="0.6"
      shadow-softness="0.9"
      environment-image="Background_sculpture_exhibition_4k.hdr"
      skybox-image="Background_sculpture_exhibition_4k.hdr"
      /* 关键：收敛相机，让主体更“贴脸” */
      field-of-view="20deg"
      camera-orbit="0deg 70deg 2.5m"
      min-camera-orbit="auto auto 1.6m"
      max-camera-orbit="auto auto 4.0m"
      interaction-prompt="none"
      style="background: transparent;">
    </model-viewer>

    <!-- 视觉用“无限地板”层（不影响取景与缩放） -->
    <div class="infinite-ground" id="ground"></div>
  </div>

  <script>
    // 让“地板椭圆”随着相机远近自适应大小与位置，
    // 但这只是 2D 叠加层，不会改变 3D 场景的 framing。
    const mv = document.getElementById('mv');
    const ground = document.getElementById('ground');

    // 基础参数可按你模型体量微调
    const BASE_SCALE = 1.0;      // 椭圆初始缩放
    const LIFT_PX    = 140;      // 往下“落地”的像素偏移（越大越靠下）
    const DEPTH_GAIN = 0.22;     // 相机半径对椭圆缩放的影响系数

    function updateGround() {
      try {
        const { radius } = mv.getCameraOrbit(); // m
        // 根据相机半径调整地板大小（半径越远，椭圆越大）
        const s = Math.max(0.6, BASE_SCALE + radius * DEPTH_GAIN);
        ground.style.setProperty('--scale', s.toFixed(3));
        ground.style.setProperty('--lift', LIFT_PX + 'px');

        // 根据视角俯仰，微调椭圆“压扁”程度
        const { theta, phi } = mv.getCameraOrbit();
        const tilt = Math.min(Math.max((phi - Math.PI/3) / (Math.PI/3), 0, 1), 1); // 60°~120°之间归一化
        const a = 60;                   // x 轴百分比
        const b = 22 + 10 * tilt;       // y 轴百分比（越俯视越扁）
        const y = 60 + 6 * tilt;        // 椭圆中心向下偏移的百分比
        ground.style.clipPath = `ellipse(${a}% ${b}% at 50% ${y}%)`;
      } catch (e) {
        // 若 API 暂不可用，忽略
      }
    }

    // 初次与相机变化时更新
    mv.addEventListener('load', updateGround);
    mv.addEventListener('camera-change', updateGround);

    // 可选：窗口尺寸变化时也更新
    window.addEventListener('resize', updateGround);
  </script>
</body>
</html>
