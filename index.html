<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Model Viewer — Fixed Z=35" with Distance Presets</title>
  <style>
    html, body { height: 100%; margin: 0; background: #000; overflow: hidden; }
    .wrap { position: relative; width: 100%; height: 100%; }
    model-viewer { width: 100%; height: 100%; background: transparent; --poster-color: transparent; }
    .toolbar {
      position: absolute; left: 16px; bottom: 16px; display: flex; gap: 8px;
      padding: 8px; border-radius: 12px; background: rgba(0,0,0,0.35); backdrop-filter: blur(6px);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }
    .toolbar button {
      border: 0; border-radius: 999px; padding: 8px 12px; cursor: pointer; font-size: 14px;
      background: rgba(255,255,255,0.14); color: #fff;
    }
    .toolbar button.active { background: #fff; color: #111; }
    .toolbar .status { color: #fff; opacity: .9; padding: 8px 12px; }
  </style>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>
  <div class="wrap">
    <model-viewer id="mv"
      src="model001.glb"
      camera-controls
      interaction-prompt="none"
      disable-zoom
      environment-image="Background_sculpture_exhibition_4k.hdr"
      skybox-image="Background_sculpture_exhibition_4k.hdr"
      field-of-view="20deg"

      <!-- 初始：r=150in，对应 φ≈13.49°；仅允许水平旋转 -->
      camera-orbit="0deg 13.49deg 150in"
      min-camera-orbit="auto 13.49deg 150in"
      max-camera-orbit="auto 13.49deg 150in"
    ></model-viewer>

    <div class="toolbar">
      <button data-r="150">150"</button>
      <button data-r="200">200"</button>
      <button data-r="250">250"</button>
      <div class="status" id="status">Z≈35", R=150"</div>
    </div>
  </div>

  <script>
    const mv = document.getElementById('mv');
    const statusEl = document.getElementById('status');
    const buttons = Array.from(document.querySelectorAll('.toolbar button'));

    // 常量：目标高度（英寸）
    const TARGET_Z_IN = 35;

    // 角度/弧度互转
    const toDeg = (rad) => rad * 180 / Math.PI;

    // 依据距离 r（英寸）计算俯仰角 φ（度）
    function phiDegFor(rIn) {
      const ratio = Math.max(Math.min(TARGET_Z_IN / rIn, 1), 0); // clamp
      return Math.asin(ratio) * 180 / Math.PI;
    }

    // 设置相机：保持当前 θ，仅更新 φ 和 r，并锁定 min/max
    function setDistanceInches(rIn) {
      const { theta } = mv.getCameraOrbit(); // radians
      const thetaDeg = toDeg(theta);
      const phiDeg = phiDegFor(rIn);

      const orbitStr = `${thetaDeg.toFixed(2)}deg ${phiDeg.toFixed(2)}deg ${rIn}in`;
      mv.setAttribute('camera-orbit', orbitStr);
      mv.setAttribute('min-camera-orbit', `auto ${phiDeg.toFixed(2)}deg ${rIn}in`);
      mv.setAttribute('max-camera-orbit', `auto ${phiDeg.toFixed(2)}deg ${rIn}in`);

      // UI 状态
      buttons.forEach(b => b.classList.toggle('active', +b.dataset.r === rIn));
      statusEl.textContent = `Z≈${TARGET_Z_IN}", R=${rIn}"`;
    }

    // 绑定按钮
    buttons.forEach(btn => {
      btn.addEventListener('click', () => setDistanceInches(+btn.dataset.r));
    });

    // 模型加载完成后，默认激活 150"
    mv.addEventListener('load', () => setDistanceInches(150));

    // 可选：窗口尺寸变化时维持锁定（不做任何缩放，让构图稳定）
    window.addEventListener('resize', () => {
      const active = buttons.find(b => b.classList.contains('active')) || buttons[0];
      setDistanceInches(+active.dataset.r);
    });
  </script>
</body>
</html>

